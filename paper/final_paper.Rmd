---
author: "Benny Chen, Mason Chen, Dotun Fatade, Ian Katz"
date: "August 9, 2016"
output: 
  pdf_document:
    fig_caption: true
    latex_engine: pdflatex
    template: svm-latex-ms.tex
title: "  Statistics 133 Final Paper: Cal Answers Data Exploration"
#thanks: "Thanks to the github user svmiller for the tex template"
#abstract: "This document provides an introduction to R Markdown, argues for its..."
geometry: margin=1in
fontfamily: mathpazo
fontsize: 12pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, error = F, warning = F)
library(readr)
library(dplyr)
library(stringr)
library(purrr)
library(ggplot2)
library(lubridate)
source("../functions/clean_df_gpa.R")
```

**Grade Point Averages of Departments**

Among faculty and students, there is a competitive spirit in the conversation of who has the toughest department or classes. There is great honor knowing that one is the taking courses in toughest department at UC Berkeley. Typically, there is not much agreement on which department is the hardest to take courses in because of bias, so this paper will try to find the true answer.

First, we took 18 semesters of grades starting from the 2010 school year to the present (2010 summer semester to 2016 spring semester). Our GPA calculation deviates from the normal Berkeley GPA calculation--instead, we counted A+ as 4.3 grade points. Our reasoning is that A+ is the hardest grade to get; in fact, out of 1189583 letter grades only 61124 people got A+'s, which only is five percent of that population! In addition, a course that is consistently giving out A+'s to students is definitely easier than a course than gives out as many A's. So, we found the average GPA by department, and the twenty departments with the highest GPA's came out as one might predict. 70% of this category is made up by language departments like Filipino, Tamil, Turkish, Korean, Vietnamese, etc. However, does this near-uniformity in subject hold for the twenty lowest GPA's? 

```{r, fig.cap = "As you can see, there is a lot more variety"}
subject_area = read_csv("../clean_data/subject_area.csv")
names(subject_area) = c("department", "canonical_name", "subject")

gpa_data = read_csv("../clean_data/gpa_data.csv.gz")

letter_grade_data = gpa_data %>%
    filter(grade_type == "Letter Grade")

#number of students in each department
num_students = letter_grade_data %>%
    group_by(department) %>%
    summarise(total = sum(grade_count))
average_class_size = mean(num_students$total)

avg_gpa_data = letter_grade_data %>%
    group_by(department, year, semester) %>%
    mutate(points = grade_pts * grade_count) %>%
    summarise(gpa = sum(points)/sum(grade_count)) %>%
    ungroup() %>%
    group_by(department) %>%
    summarise(avg_gpa = mean(gpa)) %>%
    ungroup()

avg_gpa_data = inner_join(avg_gpa_data, subject_area, "department")

#20 lowest gpas
lowest_gpas = avg_gpa_data %>%
    arrange((avg_gpa)) %>%
    head(20)

lowest_gpas %>%
    ggplot(aes(factor(department), avg_gpa)) + 
    geom_bar(stat = "identity", width = 0.5, aes(color = subject, fill = subject, alpha = 0.4)) + 
    labs(list(title = "20 Lowest GPAs by Departments", x = "Average GPA", y = "Department")) +
    coord_flip() +
    scale_x_discrete(limits = (lowest_gpas$department)) +
    scale_y_continuous(limits = c(0, 4.5), breaks = seq(0, 4.5, 0.5), expand = c(0, 0)) +
    guides(alpha = F, fill = guide_legend(title = "Subject"), color = F) + 
    theme_bw()
```

**Affirmative Action and the Ethnic Makeup of UC Berkeley Students**

Affirmative action is a hotly debated issue. Proponents argue that it gives a boost to minorities who badly need the increased educational opportunities. Opponents argue that the college admissions should be as close to a meritocracy as possible and that race-based admissions are unfair to the top students. Whether affirmative action has had a positive or negative on the school and its students is a difficult question to address, but the direct effect of affirmative action policies on the composition of the student body is clear. UC Berkeley had an affirmative action policy in place up until 1996, when California made it illegal for public universities to discriminate on the basis of race. By observing the racial composition of graduating students over time, we can see how the 1996 ban changed the ethnic makeup of the student body.

Figure **INSERT** shows the ethnic breakdown of graduating students from 1983 to 2008. From 1983 to 1996, the percentage of white students dropped drastically. At the same time, the percentage of Asian, Latino, and international students grew significantly. Interestingly, despite being considered a primary target for affirmative action policies, the population of black students from 1983 to 1996 barely fluctuated, maintaining a steady average of 4.879% of the student population. So, despite strong affirmative action policies, black students were still underrepresented at UC Berkeley.

```{r, fig.cap = "Ethnic breakdown of Berkeley over time, by percentage of the student population."}
grad_time_data <- read_csv("../clean_data/grad_time_data.csv.gz")

ethnic_breakdown <- grad_time_data %>% 
  group_by(year) %>% 
  mutate(year_total = sum(count)) %>% 
  ungroup %>% 
  group_by(ethnic_category, year) %>% 
  summarise(perc = sum(count / year_total))

ggplot(ethnic_breakdown) + 
  geom_area(aes(x = year, y = perc, fill = ethnic_category)) + 
  scale_x_continuous(limits = c(NA, NA),
                     breaks = seq(1983, 2015, 8),
                     expand = c(0, 0)) +
  scale_y_continuous(limits = c(0, 1), 
                     expand = c(0, 0)) + 
  labs(title = "Ethnic Breakdown of Students",
       x = "Year",
       y = "Percentage of Students") + 
  scale_fill_brewer(name = "Ethnicity", type = "qual", palette = 6) + 
  theme_bw()
```

After 1996, the ethnic composition of Berkeley began to stabilize. The average percentage of black students between 1996 and 2015 was 4.382%, so it slightly declined during this time. However, besides this small decline, no group made any large fluctuations in percentage of the population until 2007. In 2007, the population of white and Asian students began do decline while the population of international students began to rise. This change can most likely be explained by economic reasons. Berkeley was likely feeling the effects of the sinking economy on its budget. By admitting more international students, a larger percentage of the student population would be paying out-of-state tuition. This could help Berkeley maintain its budget without having to cut services to students. However, this strategy decreased the in-state student acceptance rate, a side effect that did not make California tax-payers happy.

It is also interesting to note which populations did not see any effect from affirmative action. The percentage of the student body that was Native American and Pacific Islander remained small and relatively unchanged over the thirty two year period. These groups are clearly underrepresented minorities, but affirmative action policies did not appear to have any effect on how many were admitted.

**How Long do Students Take to Graduate**

The time it takes to graduate can be influenced by a variety of factors. The difficulty of the major, the individual academic strength of the student, and the cost of staying in school all affect how long it takes for a student to earn his or her degree. Over the past thirty years, the cost of tuition has skyrocketed. We can observe how this trend affects how long students stay in school, and we can further separate the student body by other metrics to see if there are other strong determiners of graduation time.

According to the data, students have been graduating faster over the past thirty years. The average number of years spent in school by a student graduating in 1983 was 4.620. This number decreased almost every single year for the next thirty two years, with the average reaching 4.049 in 2008. We predicted this trend of time spent in school decreasing, as we expected rising tuition costs to push people to graduate faster. Still, the full extent of the trend was surprising. Students in 1983 spent on average more than an extra semester in school compared to students in 2008.

Further trends can be discovered by dividing the students up into different categories. Females graduate faster than males, on average. Out-of-state students graduate slightly faster than in-state students. The ethnic breakdown of graduation time is shown in figure **INSERT**. The residency gap can be explained by the increased tuition costs for out-of-state students. This would also explain why international students graduate faster compared to other groups of students. The rest of the ethnicity gap may be explained cultural and socioeconomic factors that affect school performance, but further research would be required to draw any definitive conclusions.

```{r, fig.cap = "Graduation time by ethnicity. Only includes data from students who entered Berkeley as a freshman."}
grad_time_by_ethnicity <- grad_time_data %>% 
  filter(entry_status == "New Freshmen",
         !is.na(time_to_grad)) %>% 
  group_by(ethnic_category, year) %>% 
  summarise(avg = sum(count * time_to_grad) / sum(count))

ggplot(grad_time_by_ethnicity) + 
  geom_line(aes(x = year, y = avg, color = ethnic_category), size = 0.75) + 
  scale_x_continuous(limits = c(NA, 2008),
                     breaks = seq(1983, 2008, 5),
                     expand = c(0, 0)) + 
  scale_y_continuous(limits = c(3, NA)) + 
  labs(title = "Time to Graduate by Ethnicity",
       x = "Year",
       y = "Average Number of Years to Graduate") + 
  scale_color_brewer(name = "Ethnicity", type = "qual", palette = 6) + 
  theme_bw()
```

An interesting metric to analyze is the graduation time by college. Figure **INSERT** shows this breakdown. Haas is not included because incoming freshman are not admitted into Haas, so the time taken to graduate by students in Haas is skewed compared to students in other colleges. Students in Chemistry, Environmental Design, and Natural Resources take longer to graduate than their peers in Letters & Science and Engineering. The majors offered by the Engineering department are generally considered to be difficult, but students actually complete these majors relatively quickly compared to majors offered by other colleges. The longer graduation times from the Chemistry, Environmental Design, and Natural Resources colleges may be explained by the career paths for students in these departments. Perhaps it is common in these fields to take an extra semester in order to learn as much as possible before beginning research or industry jobs. Perhaps it is common to take a co-op job, which often delays graduation by a semester or two. Whatever the reason may be, it appears that the perceived difficulty of the majors offered by each department do not correlate with how long it takes to graduate.

```{r, fig.cap = "Gradation time by College. Only includes data from students who entered Berkeley as a freshman."}
grad_time_by_college <- grad_time_data %>% 
  filter(entry_status == "New Freshmen" &
         college != "Haas School of Business" &
         !is.na(time_to_grad) &
         !is.na(college)) %>% 
  group_by(college, year) %>% 
  summarise(avg = sum(count * time_to_grad) / sum(count))

ggplot(grad_time_by_college) + 
  geom_line(aes(x = year, y = avg, color = college), size = 0.75) + 
  scale_x_continuous(limits = c(NA, 2008),
                     breaks = seq(1983, 2008, 5),
                     expand = c(0, 0)) + 
  scale_y_continuous(limits = c(3.5, 5)) + 
  labs(title = "Time to Graduate by College",
       x = "Year",
       y = "Average Number of Years to Graduate") + 
  scale_color_brewer(name = "College", type = "qual", palette = 6) + 
  theme_bw()
```


**Conclusion**

The data and analysis revealed many interesting results. Trends in the economy can have an impact on which students are admitted, what majors are chosen, and how fast people graduate. Policy changes made by the state of California regarding affirmative action have greatly affected the ethnic makeup of Berkeley students. The composition of inteded majors can greatly differ in terms of ethnic makeup. Policy changes are an appropriate method for dealing with the limited resources and growing student interest in computer science.

Although we had a wealth of data to work with, our research did have some limitations. While some Dashboards go as far back as 1983, some only contain a few years worth of data. In some cases, the data is split up over many tables with no varaibles to properly join the tables together. So, it is not always possible to directly compare two variables with each other. Ideas that could be incorporated into future research are getting access to the restricted Dashboards, gathering data from outside sources, and finding other ways to categorize and measure the student body.

There are a number of further topics that could be explored. What is the perceived difficulty of classes according students? How do these perceptions match up with the difficulty according to GPA? What percentile you need to achieve a particular letter grade for a given class? What is the average GPA of students by ethnicity, gender, and residency status? What factors influence the majors that students pick? All of these questions would be excellent springboards for future investigations of UC Berkeley student data.